<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>follone Options</title>
  <link rel="stylesheet" href="options.css">
</head>
<body data-mode="user">
  <div class="wrap">
    <h1>follone Options</h1>

  <div class="tabs">
    <button id="tabUser" class="tab">ユーザー</button>
    <button id="tabDev" class="tab">開発者</button>
  </div>
  <div class="hint">ユーザー: 必要最低限 / 開発者: 詳細設定・診断・デバッグ</div>


    <section class="card">
      <h2>基本</h2>
      <label class="row">
        <span>有効</span>
        <input type="checkbox" id="enabled">
      </label>

      <label>
        <span>AIモード</span>
        <select id="aiMode">
        <option value="auto">Prompt API（推奨）</option>
        <option value="off">OFF（AI判定しない）</option>
      </select>
      </label>

      <div class="grid2" style="margin-top:10px;">
        <label>
          <span>危険（ソフト）閾値</span>
          <input type="number" id="riskSoft" min="0" max="100" step="1">
        </label>
        <label>
          <span>危険（ハード）閾値</span>
          <input type="number" id="riskHard" min="0" max="100" step="1">
        </label>
      </div>

      <div class="grid2">
        <label>
          <span>バッチ数</span>
          <input type="number" id="batchSize" min="1" max="8" step="1">
        </label>
        <label>
          <span>アイドル(ms)</span>
          <input type="number" id="idleMs" min="100" max="5000" step="10">
        </label>
      </div>
    </section>

    <section class="card">
      <h2>フィルターバブル</h2>
      <div class="grid2">
        <label>
          <span>窓（件）</span>
          <input type="number" id="topicWindow" min="10" max="200">
        </label>
        <label>
          <span>最小サンプル</span>
          <input type="number" id="bubbleMinSamples" min="10" max="100">
        </label>
      </div>

      <div class="grid2">
        <label>
          <span>dominance</span>
          <input type="number" id="bubbleDominance" min="0.3" max="0.95" step="0.01">
        </label>
        <label>
          <span>entropy(低いほど偏り)</span>
          <input type="number" id="bubbleEntropy" min="0.1" max="1.0" step="0.01">
        </label>
      </div>

      <div class="grid2">
        <label>
          <span>クールダウン(ms)</span>
          <input type="number" id="bubbleCooldownMs" min="10000" max="3600000" step="1000">
        </label>
        <label class="row">
          <span>提案にLLMを使う</span>
          <input type="checkbox" id="bubbleUseLLM">
        </label>
      </div>
    </section>

    <section class="card">
      <h2>トピックカテゴリ（1行=1カテゴリ、最大30）</h2>
      <textarea id="topics" rows="10"></textarea>
    </section>

    <section class="card">
      <h2>レポート</h2>
      <div class="grid2">
        <label>
          <span>レポート最小秒</span>
          <input type="number" id="reportMinSeconds" min="10" max="3600">
        </label>
        <label>
          <span>無操作提案秒</span>
          <input type="number" id="inactiveSuggestSeconds" min="30" max="3600">
        </label>
      </div>
      <div class="grid2">
        <label>
          <span>無操作提案クール(ms)</span>
          <input type="number" id="inactiveCooldownMs" min="10000" max="3600000" step="1000">
        </label>
      </div>
    </section>


    <section class="card">
      <h2>Prompt API / モデル準備</h2>
      <div class="muted">
        初回はモデルのダウンロードが必要です。ダウンロード開始には「ユーザー操作（クリック）」が必要になる場合があります。<br>
        ここで一度「AIモデルを準備」を押しておくと、X上ではオフスクリーン（拡張機能側）でPrompt APIが動くようになります。
      </div>
      <div class="grid2" style="margin-top:10px;">
        <button id="warmup" type="button">AIモデルを準備（初回のみ）</button>
        <button id="backendStatus" type="button">バックエンド状態</button>
      </div>
      <div class="muted" style="margin-top:8px;">状態:</div>
      <pre id="aiStatus" class="pre"></pre>
    </section>


    <section class="card">
      <h2>デバッグ</h2>
      <label class="row">
        <span>ログを出す</span>
        <input type="checkbox" id="debug">
      </label>

      <label>
        <span>ログレベル</span>
        <select id="logLevel">
          <option value="debug">debug</option>
          <option value="info">info</option>
          <option value="warn">warn</option>
          <option value="error">error</option>
        </select>
      </label>

      <div class="muted" style="margin-top:8px;">
        DevToolsのConsoleで「[follone]」で検索すると追跡しやすいです。
      </div>
    </section>

        <section class="card devonly">
        <h2>開発者</h2>
        <div class="grid">
          <label class="row"><span>速度優先（Fast Prompt）</span><input type="checkbox" id="fastMode"></label>
          <label class="row"><span>responseConstraintを使う（遅い）</span><input type="checkbox" id="useConstraint"></label>
          <label class="row"><span>ハッシュキャッシュ無視（force LLM）</span><input type="checkbox" id="forceLLM"></label>
          <label class="row"><span>投稿ID表示（マッピング用）</span><input type="checkbox" id="showPostIds"></label>
        </div>
        <div class="hint">force LLMは同文投稿でも必ずPrompt APIへ送る（挙動確認用）。</div>
      </section>

<div class="footer">
      <button id="save">保存</button>
      <span id="status"></span>
    </div>
  </div>

  <script src="options.js"></script>
</body>
</html>
